<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Assistant | Insight Engine</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" crossorigin="anonymous"></script>

  <style>
    /* --- Global Variables and Setup --- */
    :root {
      --color-sidebar: #ffffff;
      --color-bg: #f7f8fa; /* Light, clean background */
      --color-primary: #4285f4; /* Gemini-like blue for accents */
      --color-text: #1f1f1f;
      --color-border: #e0e0e0;
      --color-user-bubble: #e6f0ff; /* Subtle blue for user */
      --color-ai-bubble: #ffffff; /* White for AI */
    }

    body {
      font-family: 'Inter', 'Roboto', sans-serif; /* Clean, modern font */
      background-color: var(--color-bg);
      color: var(--color-text);
    }

    /* Full-screen Flex Layout */
    .app-container {
      display: flex;
      height: 100vh;
      width: 100vw;
    }
    
    /* Chat Window Scroll Area */
    .chat-scroll { 
      flex-grow: 1;
      overflow-y: auto; 
      padding: 40px 0;
      max-width: 900px; /* Center and contain the chat flow */
      margin: 0 auto;
    }
    
    /* User/AI Bubble Redesign */
    .bubble-user { 
      background-color: var(--color-user-bubble); 
      color: var(--color-text); 
      border-bottom-right-radius: 6px !important;
    }
    
    .bubble-ai { 
      background-color: var(--color-ai-bubble); 
      color: var(--color-text); 
      border-bottom-left-radius: 6px !important; 
    }

    /* Custom Scrollbar (optional but sleek) */
    .chat-scroll::-webkit-scrollbar { width: 6px; }
    .chat-scroll::-webkit-scrollbar-thumb { background-color: #ccc; border-radius: 3px; }
  </style>
</head>
<body class="min-h-screen">

  <div id="appContainer" class="app-container">
    
    <aside class="w-64 bg-white p-6 flex flex-col border-r border-gray-200 shadow-sm">
      
      <header class="flex items-center gap-3 mb-8">
        <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-sm">AI</div>
        <h1 class="text-xl font-bold text-gray-800">Insight Engine</h1>
      </header>
      
      <button class="mb-6 px-4 py-2 rounded-full bg-gray-100 text-gray-800 font-medium hover:bg-gray-200 transition-colors flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        Start New Query
      </button>

      <nav class="space-y-2 flex-grow overflow-y-auto">
        <h2 class="text-xs font-semibold uppercase text-gray-500 mb-2">Recent Chats</h2>
        <a href="#" class="block p-2 text-sm text-gray-600 rounded-lg hover:bg-gray-100 transition-colors truncate">
          Project CSC331 analysis...
        </a>
        <a href="#" class="block p-2 text-sm text-gray-600 rounded-lg bg-blue-50 hover:bg-blue-100 transition-colors truncate">
          Define Quantum Computing
        </a>
        <a href="#" class="block p-2 text-sm text-gray-600 rounded-lg hover:bg-gray-100 transition-colors truncate">
          Explain Dijkstra's algorithm
        </a>
      </nav>

      <div class="mt-6 border-t pt-4">
        <button id="clearBtn" class="w-full px-4 py-2 rounded-lg bg-red-50 text-red-600 font-medium hover:bg-red-100 transition-colors flex items-center justify-center gap-2 text-sm">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
          Clear All History
        </button>
      </div>
    </aside>

    <main class="flex-grow flex flex-col relative overflow-hidden">
      
      <div id="chatWindow" class="chat-scroll space-y-5 px-5">
        <div id="welcomeWrapper" class="flex justify-start"> 
          <div id="welcomeBox" class="max-w-[80%] p-4 rounded-xl shadow-md bubble-ai inline-block">
            <strong class="text-lg">Welcome to the Insight Engine! </strong>
            <div class="mt-2 text-sm text-gray-700">How can I assist you with your academic query, code problem, or research topic today?</div>
          </div>
        </div>
      </div>
      
      <div class="w-full p-4 flex justify-center bg-transparent backdrop-blur-sm z-10">
        <footer class="flex items-center gap-3 w-full max-w-4xl bg-white p-2 rounded-2xl shadow-xl border border-gray-200">
          
          <input 
            id="questionInput" 
            type="text" 
            placeholder="Ask about CSC331, coding, or any topic..." 
            class="flex-1 p-3 rounded-xl border-none outline-none focus:ring-0 bg-transparent text-gray-800" 
          />
          
          <button 
            id="sendBtn" 
            title="Send Query" 
            class="w-10 h-10 rounded-full grid place-items-center bg-blue-500 text-white shadow-lg hover:bg-blue-600 transition-colors"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="translate-x-[1px] -translate-y-[1px]">
              <line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
          </button>
        </footer>
        <p class="absolute bottom-1 text-xs text-gray-500">
          Powered by Gemini | Insight Engine v1.0
        </p>
      </div>
    </main>
  </div>

  <script>
    const ui_chatWindow = document.getElementById("chatWindow");
    const ui_questionInput = document.getElementById("questionInput");
    const ui_sendBtn = document.getElementById("sendBtn");
    const ui_clearBtn = document.getElementById("clearBtn");
    const ui_welcomeBox = document.getElementById("welcomeWrapper");
    
    // Small helper to append chat bubbles
    function appendBubble({who="ai", text=""}) {
      const wrapper = document.createElement("div");
      wrapper.className = "flex " + (who === "user" ? "justify-end" : "justify-start") + " px-5"; 
      const bubble = document.createElement("div");
      bubble.className = "max-w-[80%] p-3 rounded-xl shadow-md text-gray-800"; 
      
      if (who === "user") {
        bubble.classList.add("bubble-user");
      } else {
        bubble.classList.add("bubble-ai");
      }
      
      bubble.innerText = text;
      wrapper.appendChild(bubble);
      ui_chatWindow.appendChild(wrapper);

      // animate with GSAP
      gsap.from(wrapper, {duration: 0.5, y: 20, opacity: 0, ease: "power3.out"});
      // scroll to bottom
      ui_chatWindow.scrollTop = ui_chatWindow.scrollHeight + 1000;
      return bubble;
    }

    async function sendQuestion() {
      const q = ui_questionInput.value.trim();
      if (!q) return;

      // show user bubble
      appendBubble({who: "user", text: q});
      ui_questionInput.value = "";
      ui_sendBtn.disabled = true;
      ui_sendBtn.style.opacity = 0.7;

      // show typing placeholder from AI
      const placeholderBubble = appendBubble({who: "ai", text: "Insight Engine is processing... â³"});

      try {
        // Ensure this endpoint matches your backend route
        const resp = await fetch("/ask", { 
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question: q })
        });

        const json = await resp.json();
        const answer = json.answer || json.data || "Error: No answer returned by API.";

        // replace placeholder
        placeholderBubble.innerText = answer;
      } catch (err) {
        placeholderBubble.innerText = "Connection Error: Failed to reach the backend service.";
      } finally {
        ui_sendBtn.disabled = false;
        ui_sendBtn.style.opacity = 1;
        ui_questionInput.focus();
      }
    }

    ui_sendBtn.addEventListener("click", sendQuestion);
    ui_questionInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendQuestion();
    });

    ui_clearBtn.addEventListener("click", () => {
      ui_chatWindow.innerHTML = "";
      ui_chatWindow.appendChild(ui_welcomeBox);
      gsap.from(ui_welcomeBox, {duration: 0.6, opacity: 0, y: -10});
    });

    // small entrance animation for container
    gsap.from("#appContainer", {duration: 0.8, opacity: 0, ease: "power2.out"});
  </script>
</body>
</html>